{
    "title": "Upgrade ",
    "linkTitle": "Upgrade",
    "weight": "230"
}This section describes how to upgrade to {{< TransferCFT/axwayvariablesReleaseNumber  >}} and higher (from versions 3.1.3, 3.2.x, 3.3.x, 3.4, 3.5).

Transfer CFT delivers procedures that can help you upgrade instances. The following sections describe how to:

1. [Create a master copy](#Create)
1. [Distribute the master copy](#Distribu)
1. [Restore the master copy](#Restore)
1. [Copy the JCLs to upgrade](#Copy)
1. [Upgrade the target instance (product environment)](#Upgrade)
1. [Customize the step PMIGR2 JCL MIGRCAT](#Customiz)

********Upgrade schema********

![](/Images/TransferCFT/temp_zos_upgrade.png)

Prerequisites
-------------

Transfer CFT requires the following z/OS version depending on the JES component used:

- JES2 requires at a minimum z/OS 2.1
- JES3 requires at a minimum z/OS 2.2

<span id="Create"></span>

Create a master copy
--------------------

A master copy is the product version that you want to use as an upgrade, and can be either a basic Transfer CFT installation, or a specific patch or service pack.

Use the A33GMAS JCL to create the master copy from the distribution environment and from the reference instance.

You must customize the following 4 variables before submitting the JCL.

- SQUAL Qualifying source:
    -   Mode 1: Prefix distribution
    -   Mode 2: Prefix model target
- TQUAL Transport prefix qualifier
- COPBASE Copilot PAX id: COPBASE, SP id or NONE
- XSRBASE Secure relay PAX id: XSRBASE, SP id or NONE

****Results****

Creates an XMIT file.

<span id="Distribu"></span>

Distribute the master copy
--------------------------

To remotely create an UPLIB library:

Use the A33GSND JCL to transfer the following elements via FTP:

- Master copy
- The components necessary to restore the master copy

Customize variables before submitting the JCL.

- Common variables:
    -   ADDRESS Remote address
    -   RQUAL Remote QUALIFIER (instance prefix)
    -   RVOL Remote Volume (optional)
    -   USER User for FTP
    -   PSW Password for FTP
- Specific variables:
    -   SNDFIL Master copy file (ADRDSSU/XMIT, generated by A33GMAS)
    -   MEMPRD Product name defined in A33IMAS
    -   MEMJCL A33IMAS JCL to restore Product

<span id="Restore"></span>

Restore the master copy
-----------------------

To create an instance:

1. Use A33IMAS JCL to restore the master version.
1. Variables must be customized before submitting the JCL transferred by the previous JCL (A33GSND).

- QUAL: identifies the prefix under which the Transfer CFT instance is restored
- PUPLIB: Set variable PUPLIB in accordance with A33GSND

<span id="Copy"></span>

Copy the JCLs to upgrade
------------------------

Copy the following JCLs from the new instance to the target instance to upgrade:

- INSTALL(UPGR0010) to upgrade libraries
- INSTALL(UPRS0010) to restore all the instance
- INSTALL(UPRM0010) to remove all backup files

<span id="Upgrade"></span>

Upgrade the target instance (product environment)
-------------------------------------------------

1. Customize the UPGR0010 JCL.
    -   Set the job card.
    -   Set the following variables:
        -   FROMQUAL new prefix package
        -   RUN Migration run ID
    -   Set migrations options (default):
        -   UPSGINST (values: YES / NO) to upgrade A12OPTP member
        -   UPA03PAR (values: YES / NO) to upgrade A03PARM member
        -   UPCOPIL (values: YES / NO) to upgrade COPILOT USS environment
        -   UPLOAD (values: DELCOPY / COPY/ NO )
            -   DELCOPY: All members are deleted before copying the new load version
            -   COPY: Copy the new load version
            -   NO: The load is not upgraded
1. Stop Transfer CFT.
    -   Transfer CFT server
    -   COPILOT server
1. Submit the UPGR0010 JCL.
    -   A file log is generated: &CFTENV..MIBK&RUN.G
    -   On the first UPGR0010 save:
        -   Transfer CFT instance files using ADRDSSU utility: &CFTENV..MIBK&RUN.A
        -   Load by IEBCOPY: &CFTENV..MIBK&RUN.L
        -   INSTALL by IEBCOPY: &CFTENV..MIBK&RUN.J
    -   After UPGR0010 upgrades the instance libraries:
        -   Restricted UPARM upgrade:
            -   Adds new members
        -   Replaces members:
            -   DEFAULT: UCONF dictionary
            -   COPCFG: Copilot UCONF variables
        -   Upgrade XMLLIB:
            -   Adds new members
            -   Replaces old members
        -   Restricted upgrade of EXEC:
            -   Add new members
        -   Upgrade of PKIMSG:
            -   Add new members
            -   Replace old members.
        -   Restricted upgrade of SAMPLE:
            -   Add new members
            -   Replace old members except member (CFTPARM)
        -   Restricted upgrade of INSTALL:
            -   Delete some samples in INSTALL now available in SAMPLE (as of v3.2.2)
            -   Add new members
            -   Replace under condition for: A12OPTSP and A03PARM
            -   Replace old members except: A00CUSTO, UPGR0010, UPRM0010, UPRS0010
            -   Save and upgrade of the Copilot USS environment
            -   The customer can choose how to manage this step with the UPCOPIL variable (YES or NO)
            -   Old Copilot is saved in a PAX &CFTENV..MIBK&RUN.N
            -   Remove USS directories
            -   Install new pax
        -   Upgrade the LOAD:
            -   The customer can choose how to manage this step with the UPLOAD variable (value=DELCOPY, COPY, NO)
1. Set A03PARM.
    -   If A03PARM was upgraded, you must customize this file.
    -   If A03PARM is not upgraded, the new missing parameters will have the compatible value.
1. Customize and submit A00CUSTO JCL:
    -   SET CFTV2 = XX.YY.ZZ Instance prefix
    -   SET DISTLIB = XX.YY Distribution prefix
    -   SET DISTLEV = ZZ Distribution suffix (latest level of CFTV2)
    -   Submit A00CUSTO

****Results****

The CFTLOAD variable defined in the CFTENV member refers to the new LOAD. If the upgrade process fails, use the UPRS0010 JCL to restore the instance files. Set the job card, and submit the JCL.

Upgrade the target instance (DATA)
----------------------------------

Customize MIGR$SET:

- OLDENV=&CFTENV
- OLDEXEC: You can use, for example, the LOAD backup: (&CFTENV..MIBK&RUN.L)
- Remember to adapt the size allocation for the work file

1. Submit MIGRPKI1 (export certificates).
1. Submit MIGRPART.
1. Submit MIGRPARM.
1. Submit MIGRPK2 (import certificates).
1. Submit MIGRCAT (\* for multi-node configuration, migrate the catalogs).
1. Submit MIGRCOM (\*for multi-node configuration).
1. Submit MIGRUCNF (\* for upgrades from 3.3.2 to 3.6, 3.7, or 3.8).

> **Note**
>
> Note: The MIGRCAT procedure migrates the catalog files, one catalog file at a time. You must modify and execute this procedure for each node.

> **Note**
>
> Note: The JCL MIGRUCNF was fixed in 3.6 SP3.

<span id="Customiz"></span>

### Customize the step PMIGR2 JCL MIGRCAT

If the migration process fails, use the UPRS0010 JCL to restore the instance files. Set the job card, and submit the JCL.

If the option UPCOPIL is set to 'NO', you must set the UCONFSET ID=cft.install_dir,VALUE='coppath/home'

Upgrade the STC CFT and Copilot if needed.

If the instance is independent from the distribution environment, customize the DISTLIB, DISTPRF and DISTLVL variables in INSTALL(CFTENV):

```
// SET DISTLIB=&CFTENV
// SET DISTPRF= -> &CFTENV without the last qualifier
// SET DISTLVL= -> last qualifier of &CFTENV
For example if CFTENV=XX.YY.ZZ
// SET DISTLIB=&CFTENV or XX.YY.ZZ
// SET DISTPRF=XX.YY
// SET DISTLVL=ZZ
```

For example, if CFTENV=XX.YY.ZZ:

```
// SET DISTLIB=&CFTENV
// SET DISTPRF= -> &CFTENV without the last qualifier
// SET DISTLVL= -> last qualifier of &CFTENV
For example if CFTENV=XX.YY.ZZ
// SET DISTLIB=&CFTENV or XX.YY.ZZ
// SET DISTPRF=XX.YY
// SET DISTLVL=ZZ
```

If the instance is linked to a distribution environment, set the DISTLIB, DISTPRF, DISTLVL variables to it.
